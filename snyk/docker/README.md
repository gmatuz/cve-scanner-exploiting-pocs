#Exploiting the docker plugin of Snyk
Let's start with the statement that this does not directly work on Snyk or at least I could not find a code path that results in the plugin being called with [manifestGlobs](https://github.com/snyk/snyk-docker-plugin/blob/ee93aeddfb20b8d595194ad3ae75f6f31241c3b8/lib/index.ts#L122)
If you want to try out the exploit you have to specifically pass it yourself like so: `snyk test --docker image:tag --manifestGlobs='[/doesntmatter]'` 
However got to admit this makes the exploit less realistic

##What is happening here
1. Snyk when looking at docker images, it does, among others, something the call [dynamic analysis](https://github.com/snyk/snyk-docker-plugin/blob/c9fca1ea29443cd1189b4a0b0f8873f154b4cac9/lib/index.ts#L45). It directly `docker run`s [commands](https://github.com/snyk/snyk-docker-plugin/blob/3b14314eefba8415a7e715d09a03f27f4eb7769a/lib/docker.ts#L107) on the image. 
2. For example checking [java](https://github.com/snyk/snyk-docker-plugin/blob/v1.37.0/lib/analyzer/binary-version-extractors/openjdk-jre.ts#L13) or [node](https://github.com/snyk/snyk-docker-plugin/blob/v1.37.0/lib/analyzer/binary-version-extractors/node.ts#L13) version. These are usually pretty benign, they look at the output and the disable networking, etc making exploitation harder. You can get DoS obviously by replacing java or node binaries with something that just runs an infinite loop, but DoS is no fun.
3. However it does also try to look for some specific files (manifestGlobs), through recursively [calling](https://github.com/snyk/snyk-docker-plugin/blob/3b14314eefba8415a7e715d09a03f27f4eb7769a/lib/docker.ts#L212) `ls` within the container.
4. Recursively as in, it [passes the output](https://github.com/snyk/snyk-docker-plugin/blob/3b14314eefba8415a7e715d09a03f27f4eb7769a/lib/docker.ts#L241) of the last `ls` to the new docker command
5. So if you create an image where `ls` [returns bash code], comlying with some [formating requirements](https://github.com/snyk/snyk-docker-plugin/blob/3b14314eefba8415a7e715d09a03f27f4eb7769a/lib/ls-utils.ts#L56), the code runs in the context of the next invocation

Given that these are docker commands in most cases this would mean [root access]()